services:
  mdbook:
    container_name: mdbook
    build:
      context: .
      target: ci-cd # build the CI/CD stage
    ports:
      - 3000:3000
      - 3001:3001
    command: ["serve", "--hostname", "0.0.0.0"]
    volumes:
      - ./book:/book/book
      - ./theme:/book/theme

  mdbook-release:
    container_name: mdbook-release
    build:
      context: .
      target: release # build the release stage
    ports:
      - 3000:3000
      - 3001:3001
    command: ["serve", "--hostname", "0.0.0.0"]
    profiles:
      - release
    volumes:
      - ./book:/book/book
      - ./theme:/book/theme
